<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>æ–°åŠ å¡éº»å°†ç»„åˆåç§°æµ‹éªŒï¼ˆé€‰æ‹©é¢˜ï¼‰</title>
  <style>
    :root{
      --bg1:#071022; --bg2:#0b1733;
      --card: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.12);
      --ink:#eaf1ff; --muted:#b7c6ee;
      --good:#2ee59d; --bad:#ff5c7a; --accent:#7aa7ff; --warn:#ffd166;
      --shadow: 0 16px 42px rgba(0,0,0,.38);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--ink);
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans SC","PingFang SC","Microsoft YaHei",sans-serif;
      background:
        radial-gradient(1200px 900px at 15% 10%, rgba(122,167,255,.18), transparent 60%),
        radial-gradient(900px 700px at 85% 25%, rgba(46,229,157,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(7,16,34,.70);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:980px;margin:0 auto;padding:14px 14px 26px}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(122,167,255,.95), rgba(46,229,157,.70));
      box-shadow: var(--shadow);
      display:grid; place-items:center;
      color:#06101e; font-weight:900;
    }
    h1{margin:0;font-size:18px}
    .sub{margin-top:2px;font-size:12px;color:var(--muted)}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      font-size:12px;color:var(--muted); font-weight:650;
    }
    .grid{
      display:grid; gap:14px; margin-top:14px;
      grid-template-columns: 1.2fr .8fr;
    }
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }
    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0; padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.03);
      font-size:14px; display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .content{padding:12px 14px 14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--ink);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:750;
      box-shadow: 0 10px 26px rgba(0,0,0,.22);
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:active{transform: translateY(1px) scale(.99)}
    button.primary{
      background: linear-gradient(135deg, rgba(122,167,255,.45), rgba(46,229,157,.16));
      border-color: rgba(122,167,255,.35);
    }
    button.ghost{background: transparent}
    button.danger{border-color: rgba(255,92,122,.35)}
    .k{
      display:inline-flex; gap:8px; align-items:center;
      padding:7px 10px; border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.14);
      color:var(--muted);
      font-size:12px; font-weight:650;
    }
    .question{
      padding:12px; border:1px dashed rgba(255,255,255,.14);
      border-radius: 16px;
      background: rgba(0,0,0,.12);
    }
    .qtitle{font-size:15px;font-weight:900;margin:0 0 6px}
    .qprompt{color:var(--muted);font-size:13px;margin:0 0 10px;line-height:1.35}
    .choices{display:grid;gap:10px}
    .choice{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
      cursor:pointer;
    }
    .choice input{margin-top:3px; width:18px;height:18px; accent-color: var(--accent)}
    .choice b{display:block}
    .choice .small{color:var(--muted);font-size:12px;margin-top:2px}
    .feedback{
      margin-top:10px;
      border-left:3px solid rgba(122,167,255,.55);
      background: rgba(122,167,255,.08);
      padding:10px 12px;
      border-radius: 12px;
      color:var(--muted);
      font-size:13px;
      display:none;
    }
    .feedback.good{border-left-color: rgba(46,229,157,.75); background: rgba(46,229,157,.08)}
    .feedback.bad{border-left-color: rgba(255,92,122,.70); background: rgba(255,92,122,.08)}
    .scorebox{
      margin-top:12px;
      padding:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
    }
    .big{font-size:22px;font-weight:950}
    .muted{color:var(--muted)}
    .list{
      margin-top:10px;
      display:grid; gap:10px;
    }
    .log{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:10px 10px;
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:13px;
    }
    .log b{color:var(--ink)}
    footer{
      padding:18px 14px 28px;
      text-align:center;
      color: rgba(234,241,255,.70);
      font-size:12px;
    }
    .toast{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background: rgba(20,30,52,.95);
      border:1px solid var(--line);
      color:var(--ink);
      padding:10px 12px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      display:none;
      max-width:min(720px, calc(100vw - 24px));
      font-size:13px;
      z-index:50;
    }
    .mini{font-size:12px}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">ğŸ€„</div>
        <div>
          <h1>æ–°åŠ å¡éº»å°†ç»„åˆåç§°æµ‹éªŒï¼ˆMultiple Choiceï¼‰</h1>
          <div class="sub">ç»ƒä¹ ï¼šåŠè‰² / æ¸…ä¸€è‰² / å¹³æ¹– / è‡­å¹³æ¹– / é—¨æ¸… / å•è°ƒ / ä¸¤é¢ç­‰ / ç¢°ç¢°èƒ¡ / ä¸ƒå¯¹</div>
        </div>
      </div>
      <div class="row">
        <span class="pill">ç¦»çº¿å¯ç”¨ Â· éšæœºå‡ºé¢˜ Â· å³æ—¶è®²è§£</span>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">

    <!-- Quiz -->
    <section class="card">
      <h2>
        <span>æµ‹éªŒ</span>
        <span class="k">é¢˜ç›® <b class="mono" id="qIndex">1</b>/<b class="mono" id="qTotal">10</b></span>
      </h2>
      <div class="content">

        <div class="row" style="justify-content:space-between">
          <div class="row">
            <span class="k">æ¨¡å¼ï¼š<b id="modeLabel">10 é¢˜éšæœº</b></span>
            <span class="k">åˆ†æ•°ï¼š<b class="mono" id="scoreNow">0</b></span>
          </div>
          <div class="row">
            <button class="ghost" id="btnNew">æ–°ä¸€è½®ï¼ˆæ¢é¢˜ï¼‰</button>
            <button class="danger" id="btnReset">æ¸…é™¤è®°å½•</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="question">
          <p class="qtitle" id="qTitle">åŠ è½½ä¸­â€¦</p>
          <p class="qprompt" id="qPrompt"></p>
          <div class="choices" id="choices"></div>

          <div class="row" style="margin-top:10px">
            <button class="primary" id="btnCheck">æ£€æŸ¥ç­”æ¡ˆ</button>
            <button id="btnNext">ä¸‹ä¸€é¢˜</button>
          </div>

          <div class="feedback" id="fb"></div>
        </div>

        <div class="scorebox">
          <div class="row" style="justify-content:space-between;align-items:flex-end">
            <div>
              <div class="muted mini">æœ¬è½®è¿›åº¦</div>
              <div class="big"><span id="doneNow">0</span>/<span id="doneTotal">10</span></div>
            </div>
            <div class="row">
              <span class="k">æ­£ç¡®ï¼š<b class="mono" id="correctNow">0</b></span>
              <span class="k">é”™è¯¯ï¼š<b class="mono" id="wrongNow">0</b></span>
            </div>
          </div>
          <div class="muted" style="margin-top:8px;line-height:1.35">
            æé†’ï¼šè¿™å¥—é¢˜åªæµ‹<strong>åç§°ä¸å®šä¹‰</strong>ï¼Œä¸æ¶‰åŠå°æ•°ï¼ˆtaiï¼‰å’ŒåŒ…ç‰Œï¼ˆshooterï¼‰ç­‰å„æ¡Œä¸åŒè§„åˆ™ã€‚
          </div>
        </div>

      </div>
    </section>

    <!-- Reference -->
    <aside class="card">
      <h2>
        <span>é€Ÿè®°å¡ï¼ˆQuick Referenceï¼‰</span>
        <span class="k">ä¸€çœ¼çœ‹æ‡‚</span>
      </h2>
      <div class="content">
        <div class="list" id="refList"></div>
        <div class="scorebox" style="margin-top:12px">
          <div class="muted mini">ä½ æœ‹å‹æ¡Œå¸¸è§ house ruleï¼ˆå¯è‡ªè¡Œæ”¹ï¼‰</div>
          <div class="muted" style="margin-top:6px;line-height:1.35">
            â€¢ è‡­å¹³æ¹– = 1 å°ï¼Œä½†<strong>ä¸èƒ½å•è°ƒ</strong><br/>
            â€¢ å¤§ç‰Œï¼ˆä¸­å‘ç™½ï¼‰ä¸èƒ½åšçœ¼<br/>
            â€¢ è‡ªå·±é£/åœˆé£ä¸èƒ½åšçœ¼ï¼ˆå…¶ä»–é£é€šå¸¸å¯åšçœ¼ï¼‰<br/>
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="primary" id="btnCopyCheat">å¤åˆ¶é€Ÿè®°å¡</button>
        </div>
      </div>
    </aside>

  </div>
</main>

<footer>
  Designed by Lim Kim Sze Â© 2026
</footer>

<div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const KEY = "sgmj_name_quiz_v1";

  const TERMS = [
    {
      id:"banse",
      zh:"åŠè‰²ï¼ˆæ··ä¸€è‰²ï¼‰",
      en:"Half Flush",
      defZh:"åªç”¨ä¸€ç§èŠ±è‰²ï¼ˆä¸‡/ç´¢/ç­’å…¶ä¸­ä¸€ç§ï¼‰+ å¯ä»¥æœ‰å­—ç‰Œï¼ˆé£/ä¸­å‘ç™½ï¼‰ã€‚ä¸èƒ½æ··ç¬¬äºŒç§èŠ±è‰²ã€‚",
      defEn:"One suit + honors allowed. No second suit.",
      promptVariants:[
        {promptZh:"ç‰Œé‡Œåªæœ‰â€œç´¢å­â€ + é£ç‰Œ/é¾™ç‰Œï¼ˆä¸­å‘ç™½ï¼‰ä¹Ÿå¯ä»¥å‡ºç°ã€‚è¿™å«ä»€ä¹ˆï¼Ÿ", promptEn:"Only ONE suit + honors (winds/dragons). What is this called?"}
      ]
    },
    {
      id:"qingyise",
      zh:"æ¸…ä¸€è‰²",
      en:"Full Flush / Pure Suit",
      defZh:"å…¨éƒ¨åŒä¸€ç§èŠ±è‰²ï¼ˆä¸‡/ç´¢/ç­’å…¶ä¸­ä¸€ç§ï¼‰ï¼Œæ²¡æœ‰ä»»ä½•å­—ç‰Œï¼ˆé£/ä¸­å‘ç™½ï¼‰ã€‚",
      defEn:"One suit only. No honors.",
      promptVariants:[
        {promptZh:"æ•´å‰¯ç‰Œåªçœ‹åˆ°â€œç­’å­â€ï¼Œæ²¡æœ‰é£ç‰Œã€æ²¡æœ‰ä¸­å‘ç™½ã€‚è¿™å«ä»€ä¹ˆï¼Ÿ", promptEn:"All tiles are one suit only (no honors). Name?"}
      ]
    },
    {
      id:"pinghu",
      zh:"å¹³æ¹–",
      en:"Ping Hu (Normal hand)",
      defZh:"æœ€æ™®é€šçš„èƒ¡ç‰Œï¼š4 å‰¯ç‰Œ + 1 å¯¹çœ¼ã€‚é€šå¸¸é¡ºå­å¤šã€æ²¡æœ‰ç‰¹åˆ«ç‰Œå‹åŠ æˆã€‚",
      defEn:"Standard 4 melds + 1 pair. Usually sequence-heavy, no special pattern.",
      promptVariants:[
        {promptZh:"4 å‰¯ç‰Œ + 1 å¯¹çœ¼ï¼Œä¸»è¦ç”±é¡ºå­ç»„æˆï¼Œæ²¡æœ‰åŠè‰²/æ¸…ä¸€è‰²/ç¢°ç¢°ç­‰ã€‚è¿™å«ä»€ä¹ˆï¼Ÿ", promptEn:"Basic hand, mostly sequences, no special pattern. Name?"}
      ]
    },
    {
      id:"choupinghu",
      zh:"è‡­å¹³æ¹–ï¼ˆæ— ç•ªå¹³æ¹–ï¼‰",
      en:"Stinky Ping Hu / No-tai hand",
      defZh:"çœ‹èµ·æ¥æ˜¯å¹³æ¹–ï¼Œä½†æ²¡æœ‰ä»»ä½•åŠ åˆ†æ¥æºï¼ˆèŠ±ã€é—¨æ¸…ã€åŠè‰²ã€é£åˆ»/é¾™åˆ»ç­‰ï¼‰ã€‚å¾ˆå¤šæ¡ŒåŸæœ¬ 0 å°ä¸èƒ½èƒ¡ï¼›æœ‰äº›æ¡Œç»™æœ€ä½ 1 å°ã€‚",
      defEn:"Looks like Ping Hu but no scoring features. Some tables disallow; some give minimum tai.",
      promptVariants:[
        {promptZh:"åªæœ‰é¡ºå­å’Œä¸€å¯¹çœ¼ï¼Œæ²¡æœ‰èŠ±ã€æ²¡æœ‰é£é¾™åˆ»ã€ä¸æ˜¯åŠè‰²æ¸…ä¸€è‰²ï¼Œä¹Ÿæ²¡é—¨æ¸…åŠ æˆã€‚è¿™é€šå¸¸å«ï¼Ÿ", promptEn:"Plain Ping Hu with no bonuses/features. Common nickname?"}
      ]
    },
    {
      id:"menqing",
      zh:"é—¨æ¸…",
      en:"Men Qing (Concealed hand)",
      defZh:"å…¨ç¨‹æ²¡æœ‰åƒã€ç¢°ã€æ˜æ ï¼ˆä¸æ‹¿åˆ«äººæ‰“å‡ºçš„ç‰Œç»„æˆå‰¯ç‰Œï¼‰ã€‚å…¨éƒ¨è‡ªå·±æ‘¸æˆç‰Œã€‚",
      defEn:"No exposed melds; you didnâ€™t chow/pong from others.",
      promptVariants:[
        {promptZh:"æ•´å±€æ²¡åƒæ²¡ç¢°æ²¡æ˜æ ï¼Œå…¨é è‡ªå·±æ‘¸ç‰Œæˆç‰Œã€‚è¿™å«ä»€ä¹ˆï¼Ÿ", promptEn:"Fully concealed (no exposed melds). Name?"}
      ]
    },
    {
      id:"dandiao",
      zh:"å•è°ƒï¼ˆå•å¼ ç­‰ï¼‰",
      en:"Single Wait",
      defZh:"åªç­‰ 1 å¼ ç‰Œæ‰èƒ½èƒ¡ã€‚å¸¸è§ï¼šå¡å¼ ï¼ˆåµŒå¼ ï¼‰ã€è¾¹å¼ ã€å•é’“å°†ï¼ˆç­‰å¯¹å­ï¼‰ã€‚",
      defEn:"Only one tile completes the hand (closed/edge/pair wait).",
      promptVariants:[
        {promptZh:"ä½ åªç­‰ä¸€å¼ ç‰Œæ‰èƒ½èƒ¡ï¼ˆä¾‹å¦‚ 2 _ 4 ç­‰ 3 / 1-2 ç­‰ 3 / ç­‰å¯¹å­ï¼‰ã€‚è¿™å«ï¼Ÿ", promptEn:"Only ONE tile can win. Whatâ€™s this wait called?"}
      ]
    },
    {
      id:"liangmian",
      zh:"ä¸¤é¢ç­‰ï¼ˆä¸¤å¤´ç­‰ï¼‰",
      en:"Two-sided wait",
      defZh:"ç­‰ä¸¤å¼ ç‰Œéƒ½èƒ½èƒ¡ã€‚ä¾‹å¦‚ 3-4 å¯ä»¥ç­‰ 2 æˆ– 5ã€‚",
      defEn:"Two tiles can complete (e.g., 3-4 waits 2 or 5).",
      promptVariants:[
        {promptZh:"3-4 è¿™ç§ç­‰æ³•ï¼Œå¯ä»¥æ¥ 2 æˆ– 5 éƒ½èƒ½èƒ¡ã€‚è¿™å«ï¼Ÿ", promptEn:"Two-sided wait (e.g., 3-4 waits 2 or 5). Name?"}
      ]
    },
    {
      id:"pengpenghu",
      zh:"ç¢°ç¢°èƒ¡ï¼ˆå¯¹å¯¹èƒ¡ï¼‰",
      en:"All Pongs / All Triplets",
      defZh:"4 å‰¯ç‰Œå…¨éƒ¨æ˜¯åˆ»å­/æ å­ï¼ˆæ²¡æœ‰é¡ºå­ï¼‰+ 1 å¯¹çœ¼ã€‚",
      defEn:"All melds are triplets/kongs (no sequences) + a pair.",
      promptVariants:[
        {promptZh:"æ•´å‰¯èƒ¡ç‰Œæ²¡æœ‰é¡ºå­ï¼Œå…¨éƒ¨æ˜¯åˆ»å­/æ å­åŠ ä¸€å¯¹çœ¼ã€‚è¿™å«ä»€ä¹ˆï¼Ÿ", promptEn:"No sequences, all triplets/kongs + a pair. Name?"}
      ]
    },
    {
      id:"qidui",
      zh:"ä¸ƒå¯¹",
      en:"Seven Pairs",
      defZh:"14 å¼ ç»„æˆ 7 ä¸ªå¯¹å­ï¼Œä¸éœ€è¦é¡ºå­/åˆ»å­ç»“æ„ã€‚",
      defEn:"7 pairs (14 tiles), no meld structure needed.",
      promptVariants:[
        {promptZh:"14 å¼ ç‰Œç›´æ¥å‡‘æˆ 7 ä¸ªå¯¹å­ï¼ˆä¸åšé¡ºåˆ»ï¼‰ã€‚è¿™å«ä»€ä¹ˆï¼Ÿ", promptEn:"14 tiles = 7 pairs. Name?"}
      ]
    },
    {
      id:"pinghu_qingyise",
      zh:"å¹³æ¹–æ¸…ä¸€è‰²ï¼ˆé¡ºå­æ¸…ä¸€è‰²ï¼‰",
      en:"Pure Ping Hu (Full flush + sequences)",
      defZh:"æ¸…ä¸€è‰² + å¹³æ¹–ï¼šåŒä¸€ç§èŠ±è‰²ã€ä»¥é¡ºå­ä¸ºä¸»ã€æ— å­—ç‰Œã€‚",
      defEn:"Full flush made as a Ping Hu style (sequence-heavy).",
      promptVariants:[
        {promptZh:"æ¸…ä¸€è‰²ï¼Œè€Œä¸”å‡ ä¹å…¨æ˜¯é¡ºå­ï¼ˆåƒå¹³æ¹–é‚£æ ·ï¼‰ã€‚è¿™å¸¸è¢«å«ï¼Ÿ", promptEn:"Full flush but sequence-heavy like Ping Hu. Name?"}
      ]
    }
  ];

  // Build a pool of questions from term prompt variants
  function buildQuestionPool(){
    const pool = [];
    for(const t of TERMS){
      for(const pv of t.promptVariants){
        pool.push({
          termId: t.id,
          answer: t.zh, // display Chinese name as answer label
          answerEn: t.en,
          promptZh: pv.promptZh,
          promptEn: pv.promptEn,
        });
      }
    }
    return pool;
  }

  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  // State
  const state = {
    roundSize: 10,
    order: [],
    idx: 0,
    picked: null,
    locked: false,
    score: 0,
    correct: 0,
    wrong: 0,
    history: [] // {q, picked, correct}
  };

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return false;
      const data = JSON.parse(raw);
      if(!data || typeof data !== "object") return false;
      Object.assign(state, data);
      return true;
    }catch(e){ return false; }
  }
  function save(){
    localStorage.setItem(KEY, JSON.stringify({
      roundSize: state.roundSize,
      order: state.order,
      idx: state.idx,
      picked: state.picked,
      locked: state.locked,
      score: state.score,
      correct: state.correct,
      wrong: state.wrong,
      history: state.history
    }));
  }

  function toast(msg){
    const t = $("toast");
    t.textContent = msg;
    t.style.display = "block";
    clearTimeout(toast._tm);
    toast._tm = setTimeout(()=>{ t.style.display="none"; }, 2100);
  }

  function getTermById(id){ return TERMS.find(x=>x.id===id); }

  function newRound(){
    const pool = buildQuestionPool();
    shuffle(pool);
    state.order = pool.slice(0, state.roundSize);
    state.idx = 0;
    state.picked = null;
    state.locked = false;
    state.score = 0;
    state.correct = 0;
    state.wrong = 0;
    state.history = [];
    save();
    render();
    toast("æ–°ä¸€è½®å·²å¼€å§‹ âœ…");
  }

  function resetAll(){
    localStorage.removeItem(KEY);
    toast("è®°å½•å·²æ¸…é™¤");
    // Start fresh
    newRound();
  }

  function makeChoices(q){
    // choices are term zh names; include 4 options
    const correctTerm = getTermById(q.termId);
    const options = [correctTerm];

    const others = TERMS.filter(t => t.id !== correctTerm.id);
    shuffle(others);
    for(const o of others){
      options.push(o);
      if(options.length >= 4) break;
    }
    shuffle(options);

    return options.map(t => ({
      labelZh: t.zh,
      labelEn: t.en,
      id: t.id
    }));
  }

  function render(){
    const total = state.order.length || state.roundSize;
    $("qTotal").textContent = String(total);
    $("doneTotal").textContent = String(total);

    $("qIndex").textContent = String(Math.min(state.idx+1, total));
    $("doneNow").textContent = String(state.idx);
    $("scoreNow").textContent = String(state.score);
    $("correctNow").textContent = String(state.correct);
    $("wrongNow").textContent = String(state.wrong);

    const q = state.order[state.idx];
    if(!q){
      // finished
      $("qTitle").textContent = "æœ¬è½®å®Œæˆ âœ…";
      $("qPrompt").innerHTML = `ä½ å®Œæˆäº†æœ¬è½® ${total} é¢˜ã€‚<br><span class="muted">Final score: ${state.score}/${total}</span>`;
      $("choices").innerHTML = "";
      $("btnCheck").disabled = true;
      $("btnNext").disabled = true;
      const fb = $("fb");
      fb.className = "feedback good";
      fb.style.display = "block";
      fb.innerHTML = `<b>æ€»ç»“ Summary</b><br>æ­£ç¡® ${state.correct}ï¼Œé”™è¯¯ ${state.wrong}ã€‚<br><span class="muted">æŒ‰ã€Œæ–°ä¸€è½®ã€å†æ¥ã€‚</span>`;
      save();
      return;
    }

    $("btnCheck").disabled = false;
    $("btnNext").disabled = !state.locked;

    // Question title and prompt
    $("qTitle").textContent = "è¿™æ˜¯ä»€ä¹ˆç‰Œå‹/æœ¯è¯­ï¼Ÿ";
    $("qPrompt").innerHTML = `<b>ä¸­æ–‡ï¼š</b>${escapeHtml(q.promptZh)}<br><b>English:</b> ${escapeHtml(q.promptEn)}`;

    // Choices
    const choices = makeChoices(q);
    const wrap = $("choices");
    wrap.innerHTML = "";
    for(const c of choices){
      const lab = document.createElement("label");
      lab.className = "choice";
      const checked = (state.picked === c.id) ? "checked" : "";
      lab.innerHTML = `
        <input type="radio" name="opt" value="${c.id}" ${checked} ${state.locked ? "disabled": ""}/>
        <div>
          <b>${escapeHtml(c.labelZh)}</b>
          <div class="small">${escapeHtml(c.labelEn)}</div>
        </div>
      `;
      const inp = lab.querySelector("input");
      inp.addEventListener("change", () => {
        if(state.locked) return;
        state.picked = inp.value;
        save();
      });
      wrap.appendChild(lab);
    }

    // Feedback
    const fb = $("fb");
    fb.style.display = "none";
    fb.className = "feedback";
    fb.textContent = "";

    save();
  }

  function checkAnswer(){
    const q = state.order[state.idx];
    if(!q) return;
    if(state.locked) return;

    if(!state.picked){
      toast("å…ˆé€‰ä¸€ä¸ªç­”æ¡ˆ ğŸ™‚");
      return;
    }

    const correctTerm = getTermById(q.termId);
    const pickedTerm = getTermById(state.picked);

    const isCorrect = (pickedTerm && pickedTerm.id === correctTerm.id);
    state.locked = true;

    const fb = $("fb");
    fb.style.display = "block";
    fb.className = "feedback " + (isCorrect ? "good" : "bad");

    if(isCorrect){
      state.score += 1;
      state.correct += 1;
      fb.innerHTML = `âœ… <b>ç­”å¯¹äº†ï¼</b><br>
        <b>${escapeHtml(correctTerm.zh)}</b> â€” ${escapeHtml(correctTerm.en)}<br>
        <span class="muted">${escapeHtml(correctTerm.defZh)}<br>${escapeHtml(correctTerm.defEn)}</span>`;
    }else{
      state.wrong += 1;
      fb.innerHTML = `âŒ <b>ä¸å¯¹</b><br>
        ä½ é€‰ï¼š<b>${escapeHtml(pickedTerm ? pickedTerm.zh : "â€”")}</b><br>
        æ­£ç¡®ï¼š<b>${escapeHtml(correctTerm.zh)}</b> â€” ${escapeHtml(correctTerm.en)}<br>
        <span class="muted">${escapeHtml(correctTerm.defZh)}<br>${escapeHtml(correctTerm.defEn)}</span>`;
    }

    state.history.push({
      idx: state.idx,
      termId: q.termId,
      picked: state.picked,
      correct: isCorrect
    });

    save();
    renderProgressOnly();
    $("btnNext").disabled = false;
  }

  function nextQuestion(){
    if(!state.locked){
      toast("å…ˆæŒ‰ã€Œæ£€æŸ¥ç­”æ¡ˆã€ğŸ™‚");
      return;
    }
    state.idx += 1;
    state.picked = null;
    state.locked = false;
    save();
    render();
  }

  function renderProgressOnly(){
    const total = state.order.length || state.roundSize;
    $("scoreNow").textContent = String(state.score);
    $("correctNow").textContent = String(state.correct);
    $("wrongNow").textContent = String(state.wrong);
    $("doneNow").textContent = String(state.idx + (state.locked ? 1 : 0));
    $("qIndex").textContent = String(Math.min(state.idx+1, total));
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function buildRef(){
    const wrap = $("refList");
    wrap.innerHTML = "";
    for(const t of TERMS){
      const div = document.createElement("div");
      div.className = "log";
      div.innerHTML = `<b>${escapeHtml(t.zh)}</b> <span class="muted">(${escapeHtml(t.en)})</span><br>
        ${escapeHtml(t.defZh)}<br><span class="muted">${escapeHtml(t.defEn)}</span>`;
      wrap.appendChild(div);
    }
  }

  function copyCheat(){
    const lines = [];
    lines.push("æ–°åŠ å¡éº»å°†æœ¯è¯­é€Ÿè®°å¡ (SG Mahjong Terms)");
    lines.push("");
    for(const t of TERMS){
      lines.push(`${t.zh} â€” ${t.en}`);
      lines.push(`- ${t.defZh}`);
      lines.push(`- ${t.defEn}`);
      lines.push("");
    }
    lines.push("House rules (example):");
    lines.push("- è‡­å¹³æ¹–=1å°ï¼Œä½†ä¸èƒ½å•è°ƒ");
    lines.push("- å¤§ç‰Œï¼ˆä¸­å‘ç™½ï¼‰ä¸èƒ½åšçœ¼");
    lines.push("- è‡ªå·±é£/åœˆé£ä¸èƒ½åšçœ¼ï¼ˆå…¶ä»–é£é€šå¸¸å¯ï¼‰");
    const text = lines.join("\n");

    navigator.clipboard?.writeText(text).then(()=>toast("å·²å¤åˆ¶é€Ÿè®°å¡ âœ…")).catch(()=>toast("æ— æ³•å¤åˆ¶ï¼ˆæ­¤æµè§ˆå™¨ä¸æ”¯æŒï¼‰"));
  }

  // Bind
  $("btnCheck").addEventListener("click", checkAnswer);
  $("btnNext").addEventListener("click", nextQuestion);
  $("btnNew").addEventListener("click", newRound);
  $("btnReset").addEventListener("click", resetAll);
  $("btnCopyCheat").addEventListener("click", copyCheat);

  // Init
  buildRef();
  if(!load() || !state.order || !state.order.length){
    newRound();
  }else{
    render();
    toast("å·²æ¢å¤ä¸Šæ¬¡è¿›åº¦ âœ…");
  }
})();
</script>
</body>
</html>
```î¨0î¨‚
